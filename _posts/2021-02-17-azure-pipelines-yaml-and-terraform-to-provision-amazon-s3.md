---
title: "Azure Pipelines (YAML) and Terraform to provision Amazon S3"
date: 2021-02-17 16:41:23 +0000
categories: []
tags: []
---

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">In my previous note, [<a href="http://skundunotes.com/2021/02/14/azure-devops-and-terraform-to-provision-aws-s3/">Azure DevOps and Terraform to provision Amazon S3</a>], I listed in detail the steps to be followed to provision an Amazon S3 bucket using Azure DevOps and Terraform. I referred to the classic editor in the build definition/azure pipelines. Build and release definitions declared via a classic editor in Azure DevOps, although they have a log/history of change, tend to evolve independently of the evolution of the code repo they support.</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">This gap was identified, and Azure DevOps has a solution of <strong>storing the build/pipeline definition as a YAML file alongside the code</strong> that it is referring to. The benefit of storing the build definition (YAML) along with the code is that the changes to the build definition are versioned in the same repo, so traceability is simpler -whoever is using the repo now has access to the build definition as well, thereby saving time and effort.</span></span></span>
<!--more-->
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Picking up from the approach in my previous note, <strong>I migrated the code repo into a new repo and added a YAML pipeline.</strong> The prerequisites remain the same -we still need IAM user credentials to provision a resource, an existing S3 bucket to store remote state, and a GitHub repo containing Terraform configuration files, and an Azure DevOps project.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">We follow the first three steps I listed in the classic editor approach. So, install the Terraform extension, create two service connections, one to GitHub and AWS for Terraform.</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">With these out of the way, laying the pipeline is relatively straight-forward. On our Azure DevOps team project, navigate to Pipelines -&gt; Pipelines -&gt; New pipeline [button at top right corner]. Here select the GitHub repository that contains Terraform configuration files (you might have to authenticate if not done so already) and<strong> configure the pipeline -existing Azure Pipelines YAML file, if you already have the YAML in the repo or -starter pipeline, if you want to add a new pipeline YAML file to your repo.</strong> If this is the first time that the GitHub repository is being added, you might be prompted to add an <em>Azure Pipelines extension</em>. You may select whether you want this extension installed on just the selected repository or all repositories. For simplicity, I suggest selecting only the repository where the Terraform configuration files are stored.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Depending upon what you selected -<em>starter pipeline</em> or <em>existing Azure pipelines YAML file</em>, you are prompted to configure the same. I had the YAML file in my repository with the same steps copied from the classic editor. If you recollect, in the classic editor, I added variables to the build definition, and I did not do so here. Since we are using an already configured Terraform extension, it was not necessary. I checked that even the build definition in classic editor worked fine with these variables removed, since there, too, we were using the same Terraform extension.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Once saved, I gave the pipeline a try, and as expected, it ran just fine.</span></span></span>
<img class="alignnone size-full wp-image-1125" src="https://skundunotes.com/wp-content/uploads/2021/02/34.-az-plines-tf-s3-image1.png" alt="34. Az-Plines-TF-S3-image1" width="824" height="447" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Here is a link to the <a href="https://github.com/kunduso/AzureDevOps-Terraform-AWS-S3-Integration" target="_blank" rel="noopener">GitHub repo</a> that contains the Terraform configuration files along with azure-pipelines.yaml file. Fork it and give it a try. Let me know if you have any suggestions and questions.</span></span></span>
