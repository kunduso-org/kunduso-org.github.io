---
title: "Working with Terraform tags"
date: 2021-08-03 10:58:28 +0000
categories: []
tags: []
---

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">A few months back, HashiCorp released a new feature in <span style="text-decoration:underline;"><a href="https://registry.terraform.io/providers/hashicorp/aws/3.38.0" target="_blank" rel="noopener">Terraform provider version 3.38.0</a></span> where they introduced default tags.
Tags have been a helpful feature while working with a cloud provider because it allows one to quickly and (depending on one's tagging strategy) uniquely identify a cloud resource. Terraform, as we know, is an infrastructure management tool that helps in provisioning resources in the cloud. As organizations mature their infrastructure management process, there is a tendency to adopt an IaC tool such as Terraform to provision as many resources as possible. Hence, as time passes, the complexity or volume of Terraform code increases, and so does the underlying infrastructure.</span></span></span>
<!--more-->
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">More often than not, when infrastructure issues creep up, certain resources are identified that would need to be re-provisioned or re-configured. In such situations, the tag/s associated with a resource is helpful in quickly identifying which terraform module/code to trigger to manage that resource. That would again depend on how smartly someone configured the tagging strategy. For e.g. in the above situation, it would be helpful to create tags such as <code>source = $(SourceCodeRepo)</code> and <code>Pipeline = $(PipelineName)</code>. Using these two tags, a team member can quickly identify the source and pipeline to fix and deploy a configuration change. There are similar use cases for using tags on resources like determining a cost center or a department to bill for a certain resource.</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Until version 3.38.0 for AWS was released, the option with the Terraform AWS provider was to use a <code>tag</code> block inside each <code>resource</code> block. For unique tags, that still is recommended. However, for tags applied to all the resources, the above approach is to repeat for each cloud resource, which is tedious. But not anymore; with the 3.38.0 version, the tag block is included in the provider block, and all resources provisioned using the provider automatically get assigned the same tag/s.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Here is an example of adding the <code>default_tag</code> block to the <code>aws provider</code> block.</span></span></span>
<img class="alignnone size-full wp-image-1402" src="https://skundunotes.com/wp-content/uploads/2021/08/47.image-2.png" alt="47.Image-2" width="381" height="208">
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">A subsequent <code>terraform plan</code> and <code>terraform apply</code> will update the tags on all the resources provisioned using the above <code>aws provider</code>.</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">The other option is to use a <code>locals</code> block for the <code>common_tags</code> and refer to that in a resource's <code>tag</code> block, as shown below.</span></span></span>
<img class="alignnone size-full wp-image-1403" src="https://skundunotes.com/wp-content/uploads/2021/08/47.image-3.png" alt="47.Image-3" width="523" height="236">
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">The above code block merges two tag blocks -the <code>local.common_tags</code> and the <code>Name=primary</code> tag. However, if a resource does not have an individual tag and the <code>common_tags</code> are sufficient, then the tags block is set as below.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><img class="alignnone size-full wp-image-1404" src="https://skundunotes.com/wp-content/uploads/2021/08/47.image-4.png" alt="47.Image-4" width="532" height="236">
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">That pretty much sums up all the tagging-related research I have done with Terraform. I hope you found this note informative.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Here is the link to <span style="text-decoration:underline;"><a href="https://www.hashicorp.com/blog/default-tags-in-the-terraform-aws-provider" target="_blank" rel="noopener">HashiCorp's official release document for tags</a></span> which I would highly recommend. That release document also has a link to the AWS tagging best practices. So again, I would highly recommend reading that.</span></span></span></span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Note: Here is the link to the <span style="text-decoration:underline;"><a href="https://d1.awsstatic.com/whitepapers/aws-tagging-best-practices.pdf" target="_blank" rel="noopener">AWS tagging best practices guide</a>.</span></span></span></span>
