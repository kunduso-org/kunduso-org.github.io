---
title: "Install and use AWS tools for PowerShell on Azure DevOps Pipelines YAML"
date: 2022-09-19 03:03:14 +0000
categories: []
tags: []
---

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Often while working on automation, I am required to interact with AWS cloud resources. For example, when using my laptop, I use the AWS CLI; I have the latest version installed. However, I prefer <strong>AWS Tools for Powershell</strong> if I automate the process into a build pipeline. If you are new to AWS Tools for Powershell, I'd recommend you read about that at <span style="text-decoration: underline"><a href="https://docs.aws.amazon.com/powershell/latest/userguide/pstools-welcome.html" target="_blank" rel="noopener">AWS-Docs</a></span>.</span></span></span>
<!--more-->
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">In this note, I list the four items to remember while using AWS Tools for Powershell with the Azure DevOps pipeline. At the end of this note, I have a link to my Git repository with all the necessary artifacts.</span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Step 1: Install the necessary modules</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">As you have read in the AWS-Docs link I shared above; the first step is to install <a href="https://www.powershellgallery.com/packages/AWS.Tools.Installer" target="_blank" rel="noopener"><code>AWS.Tools.Installer</code></a> module, which is followed by installing the <a href="https://www.powershellgallery.com/packages/AWS.Tools.Common" target="_blank" rel="noopener"><code>AWS.Tools.Common</code></a> module. Installing these two modules lays the foundation for installing any other specific module. For example, if I were required to interact with an Amazon S3 bucket, I would install <code>AWS.Tools.S3</code> or <code>AWS.Tools.EC2</code> module for the Amazon EC2 resources.</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Below is a code snippet from the <a href="https://github.com/kunduso/TestProjects/blob/main/install-aws-tools-powershell/InstallAWSTools.ps1" target="_blank" rel="noopener"><code>InstallAWSTools.ps1</code></a> script I have in my GitHub repository.</span></span></span>
<img class="alignnone size-full wp-image-1911" src="https://skundunotes.com/wp-content/uploads/2022/09/66.image-2.png" alt="66.Image-2" width="947" height="490" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">As you can see, any extra modules required would go into the <code>$RequiredModules</code> list, and the <code>foreach loop</code> would take care of it.</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">If you are interested, here is a link to all the currently available <code><a href="https://www.powershellgallery.com/packages?q=AWS.Tools" target="_blank" rel="noopener">AWS.Tools</a></code> modules. Once you identify a module you require, click on the Package Details and go through the list of Cmdlets. The cmdlets are the list of available functions that you can use.</span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Step 2: Create a profile</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">However, creating a profile would help before using any specific cmdlets in a module. I created a profile using the <code>Set-AWSCredential</code> cmdlet. Below is the code snippet from the <code><a href="https://github.com/kunduso/TestProjects/blob/main/install-aws-tools-powershell/azure-pipelines.yaml" target="_blank" rel="noopener">azure-pipelines.yaml</a></code>  file I have in my GitHub repository.</span></span></span>
<img class="alignnone size-full wp-image-1912" src="https://skundunotes.com/wp-content/uploads/2022/09/66.image-3.png" alt="66.Image-3" width="857" height="198" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">I also wanted to set the <code>DefaultAWSRegion</code> value using the cmdlet <code>Set-DefaultAWSRegion</code>. However, I learned that the setting <a href="https://docs.aws.amazon.com/powershell/latest/userguide/pstools-installing-specifying-region.html" target="_blank" rel="noopener">persists only for the current session</a>. And since each task in <code>azure-pipelines.yaml</code> was a session, setting the value was not very useful to me.</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">If you are interested, you can read more at <a href="https://stackoverflow.com/questions/73737921/unable-to-get-default-aws-region-using-powershell-in-azure-pipelines" target="_blank" rel="noopener">StackOverflow-question</a>.</span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Step 3: Use specific commands</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">This step is where you will use specific cmdlets depending on what you wish to automate. It could be to list S3 buckets or create a new ECR repository, as I have specified in this <a href="https://github.com/kunduso/app-one/blob/main/azure-pipelines.yml#L48" target="_blank" rel="noopener"><code>azure-pipelines.yaml</code></a> file.</span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Step 4: Delete the profile</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Finally, close the session using the <code>Remove-AWSCredentialProfile</code> cmdlet once you have used the other cmdlets. Note that I have the setting <code>condition: always()</code> which states that even if there were certain failures in the above steps or tasks in the <code>azure-pipelines.yaml</code> file, this step would still be executed. That way, I do not leave any lingering open sessions.</span></span></span>
<img class="alignnone size-full wp-image-1913" src="https://skundunotes.com/wp-content/uploads/2022/09/66.image-4.png" alt="66.Image-4" width="892" height="180" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">I have used and continue to use this approach, so if you face any challenges, do not hesitate to reach out and share the error message. I will get back to you at the earliest. Here is a link to my <a href="https://github.com/kunduso/TestProjects/tree/main/install-aws-tools-powershell" target="_blank" rel="noopener">GitHub repository</a> with the artifacts. You may also look at the build associated with this repository at <a href="https://littlecoding.visualstudio.com/Open-Project/_build/results?buildId=447&amp;view=results" target="_blank" rel="noopener">install-aws-tools-powershell-build</a>.</span></span></span>
