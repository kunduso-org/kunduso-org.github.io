---
title: "Enable Domain Name System (DNS) query logging for Amazon Route 53 hosted zones using Terraform"
date: 2025-04-10 05:08:00 +0000
categories: []
tags: []
---

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Maintaining visibility into DNS-related activities is crucial for organizations to ensure the <strong>security and performance</strong> of their web-based applications. Cloud engineering teams must use tools to effectively monitor and analyze DNS queries to <span style="text-decoration: underline">protect from DNS-based attacks</span> and <span style="text-decoration: underline">optimize performance</span> for genuine requests. <strong>DNS Query logging for Amazon Route 53 hosted zones</strong> addresses this challenge by offering a solution to collect, store, and analyze DNS data. This solution empowers cloud engineering teams to enhance security posture, optimize performance, and improve overall DNS management.</span></span></span>
<!--more--><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">In this note, you will learn how to enable <span style="text-decoration: underline">DNS Query logging using Amazon Route 53 and Amazon CloudWatch log groups</span>. This use case follows DevOps best practices by creating the required AWS cloud resources using Terraform (IAC) and automating the deployment using GitHub actions.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">If you are interested and want to follow along, please refer to the <a href="https://github.com/kunduso/add-aws-elb-ec2-private-subnet-terraform/tree/add-dns-query-r53" target="_blank" rel="noopener"><span style="color: #0000ff">GitHub repository: kunduso/add-aws-elb-ec2-private-subnet-terraform</span></a>. <span style="color: #ff0000">Please note the branch name is</span> <code style="background-color: #dcdcdc;font-size: 15px;color: #000000">add-dns-query-r53</code>.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">This note expands on a previous use case, where a static web page was securely accessed over HTTPS (<code style="background-color: #dcdcdc;font-size: 15px;color: #000000">port 443</code>) through a custom domain name instead of the default load balancer DNS. That setup was achieved using <strong>Amazon Route 53</strong> for DNS management and <strong>Amazon Certificate Manager (ACM)</strong> for SSL/TLS certificate management attached to a load balancer to ensure secure, reliable access to the application.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000"><strong>When DNS query logging is enabled</strong> for an Amazon Route 53 hosted zone, it captures detailed information about the DNS requests made to the hosted zone. The logs, which include data such as the queried domain name, the query type (e.g., A, AAAA, CNAME), the source IP address, and the response code, are then sent to an Amazon CloudWatch log group. The information in these logs allows cloud engineering teams to monitor DNS traffic in real-time, analyze query patterns, and detect potential security threats, such as DNS-based attacks or unusual traffic spikes.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Additionally, following security best practices, <span style="text-decoration: underline">Amazon CloudWatch Logs must be encrypted using a KMS</span> (Key Management Service) key to maintain its confidentiality and integrity. Security best practices also dictate that the <span style="text-decoration: underline">KMS key must be configured with a specific permission policy</span> tailored to its intended usage. This practice ensures that only authorized users and services can access and use the key for encryption and decryption operations.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Tying these security best practices together and building on the previous use case, this use case involves:</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000"><strong>1.</strong> Creating a KMS key and attaching a KMS key policy</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000"><strong>2.</strong> Creating a CloudWatch log group and encrypting it with the KMS key</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000"><strong>3.</strong> Configuring DNS query logging for the Amazon Route 53 hosted zone to Amazon CloudWatch logs</span></span></span>
<img class="alignnone size-large wp-image-6050" src="https://skdevops.wordpress.com/wp-content/uploads/2025/04/114-image-1.png?w=656" alt="" width="656" height="189" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Please check <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/query-logs.html" target="_blank" rel="noopener"><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #0000ff">AWS-Docs</span></span></span></a> for details on enabling DNS query logging via the Console.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000"><strong>Note:</strong> AWS requires the CloudWatch log group Logs and the associated KMS key for DNS query logging to be created in the US East (N. Virginia) region (<code style="background-color: #dcdcdc;font-size: 15px;color: #000000">us-east-1</code>). Both resources must reside in this region to ensure proper functionality of DNS query logging for Amazon Route 53 hosted zones. </span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Pre-requisites:</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Since this use case builds upon the previous use case, several AWS services have already been created. I recommend that you first review <a href="https://skundunotes.com/2025/03/25/automate-amazon-route-53-hosted-zone-acm-and-load-balancer-provisioning-with-terraform-and-github-actions/" target="_blank" rel="noopener"><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #0000ff">automate-amazon-route-53-hosted-zone-acm-and-load-balancer-provisioning-with-terraform-and-github-actions</span></span></span></a>.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Let us dive deeper into these steps.</span></span></span>
<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">1. Create a KMS key and a KMS key policy</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">As mentioned previously and in the AWS Docs, the KMS Key and the policy must be created in the <code style="background-color: #dcdcdc;font-size: 15px;color: #000000">us-east-1</code> region.</span></span></span>
<img class="alignnone size-large wp-image-6051" src="https://skdevops.wordpress.com/wp-content/uploads/2025/04/114-image-2.png?w=564" alt="" width="564" height="176" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">The Terraform code creates an AWS KMS key and a key policy to encrypt the query logs stored in CloudWatch Logs.</span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">2. Create a CloudWatch log group and encrypt it with the KMS key</span></span></span></strong>
<img class="alignnone size-large wp-image-6052" src="https://skdevops.wordpress.com/wp-content/uploads/2025/04/114-image-3.png?w=497" alt="" width="497" height="121" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">In this step, Terraform creates a CloudWatch Log Group to store the DNS query logs with a one-year retention period. The log group is configured with server-side encryption using the specified KMS key, ensuring that all stored DNS query logs are encrypted at rest for enhanced security.</span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">3. Configure DNS query logging for the Amazon Route 53 hosted zone</span></span></span></strong>
<img class="alignnone size-large wp-image-6053" src="https://skdevops.wordpress.com/wp-content/uploads/2025/04/114-image-4.png?w=611" alt="" width="611" height="88" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">In this step, the Amazon CloudWatch Log group (where the DNS query logs will be sent) is associated with the Amazon Route 53 hosted zone (whose DNS queries are being monitored). With this setup, Amazon Route 53 can automatically create log streams for the DNS queries.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Each DNS query generates a log entry containing details like:</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">- What domain was queried</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">- When the query happened</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">- Which edge location responded</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">- What type of DNS record was requested</span></span></span>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">- The response code</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Here is a screenshot from the AWS Console.</span></span></span>
<img class="alignnone  wp-image-6054" src="https://skdevops.wordpress.com/wp-content/uploads/2025/04/114-image-5.png?w=656" alt="" width="800" height="150" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Using this information, cloud engineering teams can then create CloudWatch Alarms, perform security analysis on the DNS logs, and monitor query volumes, response times, and error codes. The final objective is to transform these raw logs into actionable insights through monitoring, alerting, and automated responses to maintain security and operational excellence.</span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Multiple AWS Providers</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Most AWS resources in this use case are provisioned in the <code style="background-color: #dcdcdc;font-size: 15px;color: #000000">us-east-2</code> AWS region, which is managed using the <code style="background-color: #dcdcdc;font-size: 15px;color: #000000">provider "aws" {}</code> block. However, for DNS query logging, the CloudWatch log group and the KMS key must be provisioned in the <code style="background-color: #dcdcdc;font-size: 15px;color: #000000">us-east-1</code> region. To handle this, a separate provider with an alias, <code style="background-color: #dcdcdc;font-size: 15px;color: #000000">aws.us-east-1</code>, is used to specifically manage the CloudWatch log group and KMS key in that region. Please refer to the <a href="https://developer.hashicorp.com/terraform/language/providers/configuration" target="_blank" rel="noopener"><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #0000ff">official Terraform documentation</span></span></span></a> for more details on configuring multiple providers in Terraform.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">That brings us to the end of this note. If you have any questions or feedback, please use the comments section below. This note is part of a series on elastic load balancing, Amazon Route 53 hosted zones, and Amazon Certificate Manager.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">To learn more, please click on the links below.</span></span></span>
<a href="https://skundunotes.com/2022/07/30/add-an-application-load-balancer-to-aws-ec2-using-terraform/" target="_blank" rel="noopener"><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #0000ff">Add an application load balancer to Amazon EC2 using Terraform</span></span></span></a>
<a href="https://skundunotes.com/2023/07/26/attach-an-application-load-balancer-to-amazon-ec2-instances-in-a-private-subnet/" target="_blank" rel="noopener"><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #0000ff">Add an application load balancer to Amazon EC2 instances in a private subnet</span></span></span></a>
<a href="https://skundunotes.com/2023/09/12/create-amazon-ec2-auto-scaling-group-and-load-balancer-using-terraform-and-github-actions/" target="_blank" rel="noopener"><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #0000ff">Create an Amazon EC2 Auto Scaling group and load balancer using Terraform and GitHub Actions</span></span></span></a>
<a href="https://skundunotes.com/2025/03/25/automate-amazon-route-53-hosted-zone-acm-and-load-balancer-provisioning-with-terraform-and-github-actions/" target="_blank" rel="noopener"><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #0000ff">Automate Amazon Route 53 hosted zone, ACM, and Load Balancer provisioning with Terraform and GitHub Actions</span></span></span></a>
<a href="https://skundunotes.com/2025/04/06/attach-aws-waf-to-load-balancer-using-terraform-and-github-actions/" target="_blank" rel="noopener"><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #0000ff">Attach AWS WAF to load balancer using Terraform and GitHub Actions</span></span></span></a>
