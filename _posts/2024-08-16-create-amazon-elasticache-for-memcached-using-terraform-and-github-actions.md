---
title: "Create Amazon ElastiCache for Memcached using Terraform and GitHub Actions"
date: 2024-08-16 16:45:17 +0000
categories: []
tags: []
---

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Caches store frequently accessed data in memory, which is accessible much faster than disk-based storage or even a database. This capability reduces data retrieval latency and <span style="text-decoration: underline">improves the application response times</span>. <strong>Amazon ElastiCache for Memcached</strong> is a fully managed caching service, which means AWS handles maintenance, patching, backups, and monitoring. In this note, I demonstrate how to <span style="text-decoration: underline">create an Amazon ElastiCache for Memcached using Terraform and automate it using GitHub Actions.</span></span></span></span>
<!--more-->
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">If you are interested in learning about <strong>Amazon ElastiCache for Redis</strong>, please check -<a href="https://skundunotes.com/2023/10/21/create-an-amazon-elasticache-for-redis-cluster-using-terraform/" target="_blank" rel="noopener">Create an Amazon ElastiCache for Redis cluster using Terraform.</a></span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Amazon ElastiCache for Memcached manages caching by storing the cache data across <span style="text-decoration: underline">nodes hosted inside subnets in an Amazon VPC</span>. In Amazon ElastiCache, a Memcached node refers to an individual instance of Memcached that is part of a cache cluster hosted in a subnet. Each node is a server running the Memcached software that provides a subset of the cache. Hence, <span style="text-decoration: underline">access to the cache nodes is managed via a security group</span> that enables access from a specific CIDR or security group and on a particular port #. Also, ElastiCache supports placing cache nodes in multiple Availability Zones (AZs) within a VPC for <span style="text-decoration: underline">high availability and fault tolerance</span>. This ensures that if one AZ becomes unavailable, the cache nodes in other AZs remain accessible.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Creating an Amazon ElastiCache for Memcached has <strong>4 steps</strong>. I have the <span style="text-decoration: underline">Terraform code</span> to create and manage these AWS Cloud resources in my <span style="text-decoration: underline">GitHub repository</span>. So, if you are interested and want to follow along, here is a link to my code repository at <a href="https://github.com/kunduso/amazon-elasticache-memcached-tf/tree/create-memcached" target="_blank" rel="noopener"><code><span style="font-size: 15px"><span style="color: #0047ab">GitHub: kunduso/amazon-elasticache-memcached-tf</span></span></code></a>. </span></span></span><em><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #ff0000">Please note that the <code><span style="font-size: 15px"><span style="color: #0047ab">branch name = create-memcached</span></span></code>.</span></span></span></em>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Step 1: Create an Amazon VPC and subnets to host the ElastiCache cluster</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">I created four subnets: - two private for each ElastiCache cluster node and two public. The ElastiCache cluster does not require the public subnet at all. (<em><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #ff0000">Note: Although I called that a public subnet, there isn't a route to <code><span style="font-size: 15px"><span style="color: #0047ab">0.0.0.0/0</span></span></code> in the public subnet's route table; hence, it's as good as a private subnet</span></span></span></em>).</span></span></span>
<img class="alignnone size-full wp-image-4588" src="https://skundunotes.com/wp-content/uploads/2024/08/99-image-1.png" alt="99-image-1" width="605" height="287" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Please note that I'm referring to the branch <code><span style="font-size: 15px"><span style="color: #0047ab">create-memcached</span></span></code> in the repository.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">The <code><span style="font-size: 15px"><span style="color: #0047ab">main</span></span></code> branch of the repository uses the public subnet and has a route to the Internet using the Internet Gateway. But that is not required for this use case. The public subnets are created to support a subsequent use case: accessing the ElastiCache for Memcached cluster from an Amazon EC2 instance.</span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Step 2: Create a subnet group to host the ElastiCache cluster</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">The cache nodes in the ElastiCache cluster are spread evenly among the subnets you specify in the subnet group. The below code adds the private subnets to the subnet group.</span></span></span>
<img class="alignnone size-full wp-image-4589" src="https://skundunotes.com/wp-content/uploads/2024/08/99-image-2.png" alt="99-image-2" width="796" height="133" />
<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Step 3: Create a security group to access the ElastiCache cluster</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Amazon ElastiCache for Memcached does not provide built-in authentication mechanisms for accessing the Memcached cluster directly. This means no user/password authentication method is available, as you might find in databases or other caches. Hence, access control in Amazon ElastiCache for Memcached is managed via Security Group rules. A Security Group controls access to an ElastiCache cluster's cache nodes. In the Terraform code below, there are two blocks in a security group -the ingress and egress. Since I selected the port number <code><span style="font-size: 15px"><span style="color: #0047ab">11211</span></span></code> in the ElastiCache cluster (discussed later), I enabled ingress on that port in the attached security group with the source set to Amazon VPC's CIDR. That means that the ElastiCache cluster is accessible on that port only from inside the VPC. And for egress, I have it set to the VPC's CIDR.</span></span></span>
<img class="alignnone size-full wp-image-4590" src="https://skundunotes.com/wp-content/uploads/2024/08/99-image-3.png" alt="99-image-3" width="756" height="664" />
<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Step 4: Create the Amazon ElastiCache for the Memcached cluster</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">The Amazon ElastiCache for Memcached is the last resource to create. The code block below specifies all the properties required to create it. For a list of all the properties, check <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/elasticache_cluster" target="_blank" rel="noopener">Terraform AWS Registry: elasticache_cluster</a>.</span></span></span>
<img class="alignnone size-full wp-image-4591" src="https://skundunotes.com/wp-content/uploads/2024/08/99-image-4.png" alt="99-image-4" width="761" height="309" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">That is all the code required to create the ElastiCache cluster for Memcached. However, please note that to follow <strong>best practices</strong>, a few additional steps must be followed when using the ElastiCache cluster. These are not necessary to create the ElastiCache cluster but are required to use it.</span></span></span>

<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Best practice 1: Store the ElastiCache endpoint as an AWS Systems Manager Parameter Store parameter.</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Any application using the ElastiCache cluster will access it on the endpoint. Hence, the application would require that. Although you can embed values in the application, an alternate approach is to store these as encrypted values in the Systems Manager Parameter Store as parameters and provide permissions to the application to fetch and decrypt them from there. That way, hardcoding the values is not required, and the application stays clear of confidential data.</span></span></span>
<img class="alignnone size-full wp-image-4592" src="https://skundunotes.com/wp-content/uploads/2024/08/99-image-5.png" alt="99-image-5" width="725" height="165" />
<strong><span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Best practice 2: Create an IAM policy to access the ElastiCache cluster endpoint from the Systems Manager Parameter Store.</span></span></span></strong>
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">After storing the endpoint as a Systems Manager parameter, I created an IAM policy that allows access to that. An application would require the same IAM policy to be attached to the role it assumes to communicate with the Systems Manager parameter. After attaching the IAM policy, the application can communicate with the Systems Manager parameter and get the values of the ElastiCache endpoint.</span></span></span>
<img class="alignnone size-full wp-image-4593" src="https://skundunotes.com/wp-content/uploads/2024/08/99-image-6.png" alt="99-image-6" width="735" height="586" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Since the endpoint value is confidential, encrypting it using a KMS Key, as mentioned above, is a good practice.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Finally, I also automated the provisioning of the AWS resources using GitHub Actions. If you want to learn how I managed the authentication process, head over to this note –<a href="https://skundunotes.com/2023/02/28/securely-integrate-aws-credentials-with-github-actions-using-openid-connect/" target="_blank" rel="noopener">securely-integrate-aws-credentials-with-github-actions-using-openid-connect</a>. I also scanned my code for vulnerabilities using Bridgecrew Checkov, which generated a scan report. Here is a note on how to <a href="https://skundunotes.com/2023/04/12/automate-terraform-configuration-scan-with-checkov-and-github-actions/" target="_blank" rel="noopener">enable Checkov with GitHub Actions</a>. I'm also interested in the cost of these resources and use Infracost for that, which I have covered in detail in this note –<a href="https://skundunotes.com/2023/07/17/estimate-aws-cloud-resource-cost-with-infracost-terraform-and-github-actions/" target="_blank" rel="noopener">estimate AWS resource cost</a>. The vulnerabilities and <a href="https://github.com/kunduso/amazon-elasticache-memcached-tf/pull/6#issuecomment-2276432195" target="_blank" rel="noopener">cost estimate</a> are available in the pull request as comments.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Once I added all the Terraform code for the resources and their configurations, I pushed the changes to my remote repository. The GitHub Actions workflow concluded with the command <code><span style="font-size: 15px"><span style="color: #0047ab">terraform apply</span></span></code> enabled and provisioned the resources.</span></span></span>

<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">To verify, on the AWS Management Console, I navigated to ElastiCache → Memcached caches and selected the ElastiCache cluster that I created using the Terraform code. The image below lists some of the cluster's properties.</span></span></span>
<img class="alignnone size-full wp-image-4594" src="https://skundunotes.com/wp-content/uploads/2024/08/99-image-7.png" alt="99-image-7" width="667" height="327" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">Scrolling down, I saw the individual cache nodes, too.</span></span></span>
<img class="alignnone size-full wp-image-4595" src="https://skundunotes.com/wp-content/uploads/2024/08/99-image-8.png" alt="99-image-8" width="667" height="297" />
<span style="font-size: 18px"><span style="font-family: calibri"><span style="color: #000000">That brings us to the end of this note. Let me know if you have any questions or suggestions. In my subsequent note, I'll demonstrate how to connect using Python to the ElastiCache for Memcached from an Amazon EC2 instance in the same VPC.</span></span></span>
