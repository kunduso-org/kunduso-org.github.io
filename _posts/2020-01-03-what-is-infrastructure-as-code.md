---
title: "What is Infrastructure as Code?"
date: 2020-01-03 20:29:46 +0000
categories: []
tags: []
---

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">"Sourav, we need a new environment to perform integration testing of our application" -supervisor to me.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">"Okay..." -me.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">"Do you have that checklist that you created the last time we requested a new environment?"</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">"Yes, I was just thinking about that... But that was more than an year back and since then we've added a few more applications to our product."</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Supervisor thinking...</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Me thinking as well, as I added "We should still be able to update the checklist with the changes made in the last one year and use the same"</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">"Ok good. Lets get started on that and let us know if you need something from the development team or the operations team"</span></span></span>
<!--more-->
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">My checklist was something like:</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-request machines from data center operations teams with specific configurations (disk space, cpu, processor etc)</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-request db connectionstrings for new environment from Database team</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-request third party setup configuration values from data center operations teams</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">On the application machines:</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-create environment (system) variables</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-install windows features</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-install third party software</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-install windows certificate</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-install and configure IIS sites and websites</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-copy static apps and update config values</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">-create a new deployment group in Azure Devops and add these machines to the group</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">This checklist had all the components that had to be applied before application code was deployed to the agents. This particular environment had 4 machines so the same set of steps had to be applied on all the application machines.</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">I remember, working on setting up subsequent new environments wasn't as exciting as was the first one. Moreover, there are a few limitations in my (manual) approach:</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Not scalable and inefficient</strong>: time taken to work on 4 machines is 4 times to configure one machine</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Error prone</strong>: since this process is manual, there is high reliability on the person setting up the environment</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Non repeatable</strong>: someone else working on the checklist might attempt working at it differently -perform step 3 and 5 together etc or maybe miss step 2 altogether or maybe install a different version of a software (java or .net) and configure is differently</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Moreover, once an environment had been commissioned and in use, any subsequent change (update) was done manually. Sometimes, in the development environment, more than necessary updates are made… until desired state is achieved. However, when a higher environment needs to be updated, the same set of changes are not always made.</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Let me describe that through an example. Say to test a new feature in the product the developers realize that they need third party Installer A and B in development environment. After installing the same, the product does not appear to be behaving the way it should. They then realize that they need Installer A and C (and not B). With this information at hand, they install C and the product acts as expected. When the time to update the next higher environment comes (Environment: test), only Installer A and C are installed there (installer B is not; and rightfully so since that was not needed in the first place).</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Development environment consist of Installer A, B and C.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Test environment consist of Installer A and C.</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">In this case development and test environments are no longer identical -environment drift. An environment drift occurs when no two environments (or servers) are 100% identical and thereby are no longer reliable.</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">A primary driver in my professional journey has been -how do I <em>continuously delivery value</em> to my employer and our customers and make my job intellectually stimulating such that I continue to add new skills and competencies which feed into my ability to deliver value.</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">I knew that an automated approach would address those factors such that all the steps mentioned could be converted into modules/scripts and an orchestrator could be used to execute these on the machines to bring them to desired state. I had a little experience working with Chef and I borrowed heavily on the ideas on which the tool is based. And that is when I learnt about infrastructure as code. I was fascinated by the fact that we could have a few (maybe a little more than that) lines of code (version controlled) and use them to provision environments on the fly.</span></span></span>
<img class="alignnone size-full wp-image-262" src="https://skundunotes.com/wp-content/uploads/2020/01/10.-iac-image1.png" alt="10. IaC-Image1" width="439" height="442" />
<blockquote><span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><em>Infrastructure as code is an approach to infrastructure automation based on practices from software development. It emphasizes consistent, repeatable routines for provisioning and changing systems and their configuration. Changes are made to definitions and then rolled out to systems through unattended processes that include thorough validation.</em> -Kief Morris in Infrastructure as code (<a href="https://twitter.com/kief">@kief</a>)</span></span></span></blockquote>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Characteristics of a IaC module:</strong></span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">The idea to automate the process of provisioning an environment not only addresses challenges around productivity but also around quality. The author of an IaC module must be sensitive to the following:</span></span></span>
<ul>
	<li><em>Create IaC modules as tiny, independent and decoupled as possible</em>.</li>
</ul>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Although the first few iterations of IaC adoption in an organization might start from taking a pristine machine and then executing a series of automated steps to bring it to desired steps, that might not be the case always. As an organization's IaC process matures, there can be instances when only a certain component of server provisioning might require an update. In that case, going through 1000s of lines of code and extracting a snippet to perform a specific task might distract the implementor. Creating components that are isolated and standalone ensures that the process of IaC is extendable and reliable.</span></span></span>
<ul>
	<li><em>Automate provisioning, automate verification</em>.</li>
</ul>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Each IaC module should encompass a verification step which effectively means that the system not only provisions but also checks the end result post provisioning. This kind of verification increases reliability in the process and ensures that there are no false positives (automation process completed without any error, but desired state of environment not achieved).</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Benefits of IaC:</strong></span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">A few primary benefits that come to my mind immediately are as follows:</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Speed:</strong> With an automation script, the process to commission an environment is going to be faster than a manual process.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Scale:</strong> Whether I need 4 machines or 400 machines, the setup time does not need to be very different than the time needed for one machine, unless otherwise desired.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Consistent:</strong> The same setup technique (scripts and configuration values) would ensure that the machines/environments that are being configured are identical.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Repeatable:</strong> The setup process is identical for all the machines and is being followed for each new provision.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Versionable:</strong> By storing IaC assets in a source control repository, it is possible to track how a module evolved over time with additional information about the author and related work items.</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Challenges to IaC approach:</strong></span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Occasionally there are instances when a product environment requires some update. This usually starts by someone making that change (manually) on one of the lower environments to align with the changing needs of the product being developed. Once that change has been tested, there is a tendency to proceed with the manual approach for all other environments.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">This arises due to two reasons: (i) making manual change is quicker than writing code to automate the process and (ii) making manual change ensures that nothing else has changed; less faith in the entire automation technique -what if something else breaks?</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">However, in the long run, such a mindset is detrimental to the culture of an organization that is moving their infrastructure to code. The only way to have 100% faith in your IaC modules is to use it as many times as possible, improving with each iteration. And hence, from time to time, higher management must be firm in their resolve that infrastructure should also be treated as a product and follow an identical lifecycle.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">The organization should understand and agree that adopting IaC is not a one-time process but a continuous one.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">For an organization moving towards IaC, the first iteration is usually the longest one. Staying committed to the process is critical to early adoption.</span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Breakeven: How many machines and environments do we need to ensure that the spend towards IaC is cost effective? I think, if an organization is talking about IaC, they probably need IaC.<img class="alignnone size-full wp-image-263" src="https://skundunotes.com/wp-content/uploads/2020/01/10.-iac-image2.png" alt="10. IaC-Image2" width="431" height="641" /></span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;"><strong>Conclusion:</strong></span></span></span>
<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Although servers and environments hosting the product are not what the customer sees directly, it greatly aids in customer experience. Hence any organization that is obsessed about customer experience, should take their infrastructure very seriously and adopting a IaC mindset makes that scalable, consistent and repeatable.</span></span></span>

<span style="font-size:18px;"><span style="font-family:calibri;"><span style="color:#000000;">Further reading:  <a href="https://www.oreilly.com/library/view/infrastructure-as-code/9781491924334/ch01.html">https://www.oreilly.com/library/view/infrastructure-as-code/9781491924334/ch01.html</a></span></span></span>
